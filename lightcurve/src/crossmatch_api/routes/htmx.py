import re
import os
from typing import Annotated
from fastapi import Query
import json

#from core.services.object import get_mag_stats
from fastapi import APIRouter, Request, HTTPException
from fastapi.templating import Jinja2Templates
from fastapi.responses import HTMLResponse
from ..result_handler import handle_error, handle_success

router = APIRouter()
templates = Jinja2Templates(
    directory="src/crossmatch_api/templates", autoescape=True, auto_reload=True
)
templates.env.globals["OAPI_URL"] = os.getenv(
    "OBJECT_API_URL", "http://localhost:8000"
)

@router.get("/crossmatch/", response_class=HTMLResponse)
async def object_mag_app(
    request: Request,
):
  
    cross = [{"2MASS":{"Dec":{"unit":"deg","value":45.023792},"Epoch":{"unit":"JD","value":2451114.7385},"ErrMaj":{"unit":"arcsec","value":0.06},"MagErr_H":{"unit":"mag","value":0.096},"MagErr_J":{"unit":"mag","value":0.086},"MagErr_K":{"unit":"mag","value":0.08},"Mag_H":{"unit":"mag","value":13.196},"Mag_J":{"unit":"mag","value":13.834},"Mag_K":{"unit":"mag","value":13.028},"RA":{"unit":"deg","value":30.745452000000004},"distance":{"unit":"arcsec","value":14.247656324772855}}},{"2MASSxsc":{"Dec":{"unit":"deg","value":45.02374611111111},"H_K20e":{"unit":"mag","value":11.770999908447266},"Hb_a":{"unit":" ","value":0.8799999952316284},"Hpa":{"unit":"deg","value":85.0},"J_K20e":{"unit":"mag","value":12.439000129699707},"Jb_a":{"unit":" ","value":0.8999999761581421},"Jpa":{"unit":"deg","value":85.0},"K_K20e":{"unit":"mag","value":11.493000030517578},"Kb_a":{"unit":" ","value":0.8199999928474426},"Kpa":{"unit":"deg","value":-80.0},"RA":{"unit":"deg","value":30.74543999999999},"distance":{"unit":"arcsec","value":14.087121322752465},"e_H_K20e":{"unit":"mag","value":0.041999999433755875},"e_J_K20e":{"unit":"mag","value":0.028999999165534973},"e_K_K20e":{"unit":"mag","value":0.05400000140070915},"r_K20e":{"unit":"arcsec","value":12.699999809265137}}},{"GAIA/DR1":{"Dec":{"unit":"deg","value":45.02380300757671},"ErrDec":{"unit":"mas","value":83.49758965488286},"ErrMagG":{"unit":"mag","value":0.034113821418772054},"ErrRA":{"unit":"mas","value":50.17375667264331},"ExcessNoise":{"unit":" ","value":7.699700716380539},"ExcessNoiseSig":{"unit":" ","value":180.2058477885301},"MagG":{"unit":"mag","value":17.477072046839638},"RA":{"unit":"deg","value":30.74544998992997},"distance":{"unit":"arcsec","value":14.28045699927156}}},{"GAIA/DR2":{"A_G":{"unit":"mag","value":0},"Dec":{"unit":"deg","value":45.023808349998475},"Epoch":{"unit":"JYear","value":2015.5},"ErrDec":{"unit":"mas","value":4.208503792388187},"ErrPMDec":{"unit":"mas/yr","value":0},"ErrPMRA":{"unit":"mas/yr","value":0},"ErrPlx":{"unit":"mas","value":0},"ErrRA":{"unit":"mas","value":3.8819642049744942},"ErrRV":{"unit":"km/s","value":0},"ExcessNoise":{"unit":"mas","value":13.304921935906172},"ExcessNoiseSig":{"unit":" ","value":694.2086300916627},"MagErr_BP":{"unit":"mag","value":0},"MagErr_G":{"unit":"mag","value":0.023199313505397046},"MagErr_RP":{"unit":"mag","value":0},"Mag_BP":{"unit":"mag","value":0},"Mag_G":{"unit":"mag","value":17.598984},"Mag_RP":{"unit":"mag","value":0},"PMDec":{"unit":"mas/yr","value":0},"PMRA":{"unit":"mas/yr","value":0},"Plx":{"unit":"mas","value":0},"RA":{"unit":"deg","value":30.745445623834605},"RA_Dec_Corr":{"unit":" ","value":-0.37909698},"RV":{"unit":"km/s","value":0},"Teff":{"unit":"K","value":0},"Teff_high":{"unit":"K","value":0},"Teff_low":{"unit":"K","value":0},"VarFlag":{"unit":" ","value":-1.0},"distance":{"unit":"arcsec","value":14.292424287053695}}},{"GALEX":{"Dec":{"unit":"deg","value":45.0213511652968},"NUV_FWHM_WORLD":{"unit":"deg","value":-99.0},"RA":{"unit":"deg","value":30.7479440244905},"distance":{"unit":"arcsec","value":13.48437874194704},"fuv_mag":{"unit":"mag","value":21.04805},"fuv_magerr":{"unit":"mag","value":0.4213389},"fuv_weight":{"unit":"s","value":60.13281},"nuv_mag":{"unit":"mag","value":-999.0},"nuv_magerr":{"unit":"mag","value":-999.0},"nuv_weight":{"unit":"s","value":64.09375}}},{"NEDz":{"Dec":{"unit":"deg","value":45.02381},"Filter":{"unit":" ","value":1.0},"Mag":{"unit":"mag","value":15.0},"ObjType":{"unit":" ","value":9.0},"RA":{"unit":"deg","value":30.74525},"RedshiftType":{"unit":" ","value":1.0},"Velocity":{"unit":"km/s","value":7308.0},"distance":{"unit":"arcsec","value":14.076062694631219},"z":{"unit":" ","value":0.024377}}},{"APASS":{"B":{"unit":"mag","value":16.025},"BV":{"unit":"mag","value":0.945},"BVerr":{"unit":"mag","value":0.088},"Berr":{"unit":"mag","value":0.084},"Dec":{"unit":"deg","value":45.023814},"Decerr":{"unit":"arcsec","value":0.504},"Mobs":{"unit":" ","value":15.0},"Name":{"unit":" ","value":20122078.0},"Nobs":{"unit":" ","value":2.0},"RA":{"unit":"deg","value":30.745559},"RAerr":{"unit":"arcsec","value":0.701},"V":{"unit":"mag","value":15.079},"Verr":{"unit":"mag","value":0.026},"distance":{"unit":"arcsec","value":14.445129792025494},"g":{"unit":"mag","value":15.537},"gerr":{"unit":"mag","value":0.031},"i":{"unit":"mag","value":14.299},"ierr":{"unit":"mag","value":0.015},"r":{"unit":"mag","value":14.753},"rerr":{"unit":"mag","value":0.029}}},{"UCAC4":{"DSflag":{"unit":" ","value":0.0},"Dec":{"unit":"deg","value":45.023771111111124},"EpochDec":{"unit":"year","value":1990.77},"EpochRA":{"unit":"year","value":1999.2},"ErrDec":{"unit":"mas","value":127.0},"ErrMag":{"unit":"mag","value":0.21},"ErrMagB":{"unit":"mag","value":0.08},"ErrMagH":{"unit":"mag","value":0.1},"ErrMagJ":{"unit":"mag","value":0.09},"ErrMagK":{"unit":"mag","value":0.08},"ErrMagV":{"unit":"mag","value":0.03},"ErrMagg":{"unit":"mag","value":0.03},"ErrMagi":{"unit":"mag","value":0.02},"ErrMagr":{"unit":"mag","value":0.03},"ErrPM_Dec":{"unit":"mas/yr","value":5.8},"ErrPM_RA":{"unit":"mas/yr","value":5.4},"ErrRA":{"unit":"mas","value":72.0},"Flag2MASSext":{"unit":" ","value":8.0},"FlagExtCat":{"unit":" ","value":10.0},"FlagH":{"unit":" ","value":5.0},"FlagJ":{"unit":" ","value":4.0},"FlagK":{"unit":" ","value":5.0},"FlagLEDA":{"unit":" ","value":0.0},"FlagYale":{"unit":" ","value":0.0},"ID":{"unit":" ","value":158532166.0},"ID2MASS":{"unit":" ","value":1316360441.0},"MagAper":{"unit":"mag","value":15.278},"MagB":{"unit":"mag","value":16.025},"MagH":{"unit":"mag","value":13.196},"MagJ":{"unit":"mag","value":13.834},"MagK":{"unit":"mag","value":13.028},"MagModel":{"unit":"mag","value":15.343},"MagV":{"unit":"mag","value":15.079},"Magg":{"unit":"mag","value":15.537},"Magi":{"unit":"mag","value":14.299},"Magr":{"unit":"mag","value":14.753},"Nep":{"unit":" ","value":2.0},"Nim":{"unit":" ","value":2.0},"Nobs":{"unit":" ","value":2.0},"ObjType":{"unit":" ","value":0.0},"PM_Dec":{"unit":"mas/yr","value":-3.9},"PM_RA":{"unit":"mas/yr","value":4.0},"RA":{"unit":"deg","value":30.745529166666664},"RecordUCAC2":{"unit":" ","value":0},"ZoneUCAC2":{"unit":" ","value":0},"distance":{"unit":"arcsec","value":14.273199716372648}}},{"WISE":{"Dec":{"unit":"deg","value":45.0238187},"Dist_2MASS":{"unit":"arcsec","value":0.106},"ErrDec":{"unit":"arcse","value":0.0752},"ErrRA":{"unit":"arcsec","value":0.0778},"MagErr_H":{"unit":"mag","value":0.097},"MagErr_J":{"unit":"mag","value":0.087},"MagErr_K":{"unit":"mag","value":0.08},"MagErr_W1":{"unit":"mag","value":0.023},"MagErr_W2":{"unit":"mag","value":0.022},"MagErr_W3":{"unit":"mag","value":0.033},"MagErr_W4":{"unit":"mag","value":0.117},"Mag_H":{"unit":"mag","value":13.196},"Mag_J":{"unit":"mag","value":13.834},"Mag_K":{"unit":"mag","value":13.028},"Mag_W1":{"unit":"mag","value":11.662},"Mag_W2":{"unit":"mag","value":11.719},"Mag_W3":{"unit":"mag","value":9.393},"Mag_W4":{"unit":"mag","value":7.482},"MeanMJD_W1":{"unit":"MJD","value":55226.98820242},"PA_2MASS":{"unit":"deg","value":-154.9},"RA":{"unit":"deg","value":30.7454696},"RChi2_W1":{"unit":" ","value":29.75},"RChi2_W2":{"unit":" ","value":8.95199966},"RChi2_W3":{"unit":" ","value":3.329},"RChi2_W4":{"unit":" ","value":1.255},"SNR_W1":{"unit":" ","value":46.6},"SNR_W2":{"unit":" ","value":49.2},"SNR_W3":{"unit":" ","value":32.9},"SNR_W4":{"unit":" ","value":9.3},"Sky_W1":{"unit":"DN","value":13.185},"Sky_W2":{"unit":"DN","value":34.574},"Sky_W3":{"unit":"DN","value":2002.309},"Sky_W4":{"unit":"DN","value":589.567},"VarL_W1":{"unit":" ","value":0.0},"VarL_W2":{"unit":" ","value":0.0},"VarL_W3":{"unit":" ","value":0.0},"VarL_W4":{"unit":" ","value":1.0},"distance":{"unit":"arcsec","value":14.353594195720394}}},{"unWISE":{"Dec":{"unit":"deg","value":45.02379594499043},"ErrMag_w1":{"unit":"magAB","value":0.0013683100047677027},"ErrMag_w2":{"unit":"magAB","value":0.003133321636185067},"FlagsAdd_w1":{"unit":" ","value":66.0},"FlagsAdd_w2":{"unit":" ","value":66.0},"Flags_w1":{"unit":" ","value":0.0},"Flags_w2":{"unit":" ","value":0.0},"MagAB_w1":{"unit":"magAB","value":14.54061649422899},"MagAB_w2":{"unit":"magAB","value":15.166848516902913},"N_w1":{"unit":" ","value":130.0},"N_w2":{"unit":" ","value":133.0},"RA":{"unit":"deg","value":30.74545754227731},"SkyMag_w1":{"unit":"magAB","value":23.256594196561885},"SkyMag_w2":{"unit":"magAB","value":23.472267900119938},"distance":{"unit":"arcsec","value":14.26676815042138}}}]
   
    return templates.TemplateResponse(
      name='crossmatch.html.jinja',
      context={'request': request,
               'cross': cross
               },
  )

